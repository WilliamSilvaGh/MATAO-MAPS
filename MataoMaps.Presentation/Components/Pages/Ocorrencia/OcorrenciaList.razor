<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listar Ocorrências</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css">
    <style>
        .modal-dialog {
            max-width: 500px;
        }

        .text-black {
            color: black;
        }

        .descricao-column {
            white-space: normal;
            word-wrap: break-word;
            text-align: justify;
            hyphens: auto;
        }

        .text-wrap {
            white-space: normal;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h3>Listar Ocorrências</h3>

        <div class="alert" id="notification" style="display:none;"></div>

        <div style="width: 80%;">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Hora</th>
                        <th>Nome do Usuário</th>
                        <th>Tipo de Ocorrência</th>
                        <th>Descrição</th>
                        <th>Resolução</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="ocorrencias-body">
                    <!-- As ocorrências serão inseridas aqui via JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Modal de Iniciar Atendimento -->
        <div class="modal" id="modalEdicao" tabindex="-1" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-black">Iniciar Atendimento</h5>
                        <button type="button" class="btn-close" onclick="cancelarEdicao()" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-black">
                        <p>Deseja realmente iniciar o atendimento desta ocorrência?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="cancelarEdicao()">Cancelar</button>
                        <button type="button" class="btn btn-primary" onclick="confirmarEdicao()">Confirmar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Encerrar Ocorrência -->
        <div class="modal" id="modalEncerrar" tabindex="-1" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-black">Encerrar Ocorrência</h5>
                        <button type="button" class="btn-close" onclick="cancelarEncerrar()" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-black">
                        <p>Informe a resolução da ocorrência:</p>
                        <textarea class="form-control" id="descricaoResolucao" required></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="cancelarEncerrar()">Cancelar</button>
                        <button type="button" class="btn btn-primary" onclick="confirmarEncerrar()">Confirmar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ocorrencias = []; // Aqui você deve preencher com as ocorrências obtidas via API

        function loadOcorrencias() {
            const tbody = document.getElementById('ocorrencias-body');
            tbody.innerHTML = ''; // Limpa o corpo da tabela

            ocorrencias.forEach(data => {
                const row = document.createElement('tr');
                row.innerHTML = `
                            <td>${data.Data}</td>
                            <td>${data.Hora}</td>
                            <td>${data.UsuarioNome}</td>
                            <td>${data.TipoOcorrencia}</td>
                            <td class="descricao-column">${data.Descricao}</td>
                            <td class="descricao-column">${data.DescricaoResolucao}</td>
                            <td>${data.Status}</td>
                            <td>
                                ${data.Status === "AFazer" ? `<button class="btn btn-primary" onclick="confirmarEdicao('${data.Id}')">Iniciar Atendimento</button>` : ''}
                                ${data.Status === "EmAndamento" ? `<button class="btn btn-danger" onclick="confirmarEncerrar('${data.Id}')">Encerrar Ocorrência</button>` : ''}
                            </td>
                        `;
                tbody.appendChild(row);
            });
        }

        function mostrarNotificacao(mensagem, tipo) {
            const notification = document.getElementById('notification');
            notification.className = `alert alert-${tipo}`;
            notification.innerHTML = mensagem;
            notification.style.display = 'block';
        }

        function confirmarEdicao(id) {
            // Lógica para confirmar edição
            document.getElementById('modalEdicao').style.display = 'block';
        }

        function cancelarEdicao() {
            document.getElementById('modalEdicao').style.display = 'none';
        }

        function confirmarEncerrar(id) {
            // Lógica para confirmar encerramento
            document.getElementById('modalEncerrar').style.display = 'block';
        }

        function cancelarEncerrar() {
            document.getElementById('modalEncerrar').style.display = 'none';
        }

        function confirmarEncerrar() {
            const descricaoResolucao = document.getElementById('descricaoResolucao').value;
            // Lógica para fazer a requisição de encerramento
        }

        // Carregamento inicial
        window.onload = loadOcorrencias;
    </script>
</body>
</html>
